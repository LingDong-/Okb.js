"x"in[]||"y"in[]||"z"in[]?console.log("Warning: Failed to define xyz properties of Arrays, vectors might not work as expected."):(Object.defineProperty(Array.prototype,"x",{get:function(){return this[0]},set:function(t){this[0]=t}}),Object.defineProperty(Array.prototype,"y",{get:function(){return this[1]},set:function(t){this[1]=t}}),Object.defineProperty(Array.prototype,"z",{get:function(){return this[2]},set:function(t){this[2]=t}}));var Okb=new function(){var t=this;this.vector=new function(){var t=this;function n(n){return t.vector(n.x||0,n.y||0,n.z||0)}this.vector=function(t,n,r,e){var o=e;if(o instanceof Array)return[t,n].concat(null!=r&&null!=o.z?[r]:[]);var i=null==e?{x:t,y:n}:Object.assign({},e,{x:t,y:n});return null==r||null!=o&&null==o.z||(i.z=r),i},this.forward=t.vector(0,0,1),this.up=t.vector(0,1,0),this.right=t.vector(1,0,0),this.zero=t.vector(0,0,0),this.rotateAxial=function(r,e,o){r=n(r);var[i,a,l]=[e.x,e.y,e.z],[u,h,s]=[r.x,r.y,r.z],[c,f]=[Math.cos(o),Math.sin(o)],v={};return v[11]=i*i*(1-c)+c,v[12]=a*i*(1-c)-l*f,v[13]=l*i*(1-c)+a*f,v[21]=i*a*(1-c)+l*f,v[22]=a*a*(1-c)+c,v[23]=l*a*(1-c)-i*f,v[31]=i*l*(1-c)-a*f,v[32]=a*l*(1-c)+i*f,v[33]=l*l*(1-c)+c,t.vector(u*v[11]+h*v[12]+s*v[13],u*v[21]+h*v[22]+s*v[23],u*v[31]+h*v[32]+s*v[33],r)},this.rotateEuler=function(n,r){return 0!=r.z&&(n=t.rotateAxial(n,t.forward,r.z)),0!=r.x&&(n=t.rotateAxial(n,t.right,r.x)),0!=r.y&&(n=t.rotateAxial(n,t.up,r.y)),n},this.copy=function(n){return t.vector(n.x,n.y,n.z,n)},this.scale=function(n,r){return t.vector(n.x*r,n.y*r,n.z*r,n)},this.add=function(){for(var n=t.vector(0,0,0,arguments[0]),r=0;r<arguments.length;r++)"number"==typeof arguments[r]?(n.x+=arguments[r]||0,n.y+=arguments[r]||0,n.z+=arguments[r]||0):(n.x+=arguments[r].x||0,n.y+=arguments[r].y||0,n.z+=arguments[r].z||0);return n},this.multiply=function(){for(var n=t.vector(1,1,1),r=0;r<arguments.length;r++)"number"==typeof arguments[r]?(n.x*=arguments[r]||0,n.y*=arguments[r]||0,n.z*=arguments[r]||0):(n.x*=arguments[r].x||0,n.y*=arguments[r].y||0,n.z*=arguments[r].z||0);return t.vector(n.x,n.y,n.z,arguments[0])},this.subtract=function(r,e){var o=n(r);return e=n(e),t.vector(o.x-e.x,o.y-e.y,o.z-e.z,r)},this.magnitude=function(t){return t=n(t),Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)},this.normalize=function(r){var e=r;r=n(r);var o=t.magnitude(r);if(0==o)return t.vector(r.x,r.y,r.z,e);var i=1/o;return t.vector(r.x*i,r.y*i,r.z*i,e)},this.lerp=function(r,e,o){var i=n(r),a=n(e);return t.vector(i.x*(1-o)+a.x*o,i.y*(1-o)+a.y*o,i.z*(1-o)+a.z*o,r)},this.distance=function(){for(var t=0,r=0;r<arguments.length-1;r++){var e=n(arguments[r]),o=n(arguments[r+1]);t+=Math.sqrt(Math.pow(e.x-o.x,2)+Math.pow(e.y-o.y,2)+Math.pow(e.z-o.z,2))}return t},this.dot=function(t,r){return t=n(t),r=n(r),t.x*r.x+t.y*r.y+t.z*r.z},this.cross=function(r,e){var o=r;return r=n(r),e=n(e),t.vector(r.y*e.z-r.z*e.y,r.z*e.x-r.x*e.z,r.x*e.y-r.y*e.x,o)},this.cosine=function(n,r){return t.dot(n,r)/(t.magnitude(n)*t.magnitude(r))},this.angle=function(n,r){return Math.acos(t.cosine(n,r))},this.elementwise=function(n,r){return t.vector(r(n.x),r(n.y),r(n.z),n)},this.toColumn=function(t){return[[t.x],[t.y],[t.z]]},this.toRow=function(t){return[[t.x,t.y,t.z]]}},this.random=new function(){var n,r=this,e=function(){var t,n,r=4294967296;return{setSeed:function(e){n=t=(null==e?Math.random()*r:e)>>>0},getSeed:function(){return t},rand:function(){return(n=(1664525*n+1013904223)%r)/r}}},o=4,i=.5,a=function(t){return.5*(1-Math.cos(t*Math.PI))};this.perlin=function(t,r,e){if(r=r||0,e=e||0,null==n){n=new Array(4096);for(var l=0;l<4096;l++)n[l]=Math.random()}t<0&&(t=-t),r<0&&(r=-r),e<0&&(e=-e);for(var u,h,s,c,f,v=Math.floor(t),d=Math.floor(r),p=Math.floor(e),g=t-v,y=r-d,M=e-p,x=0,m=.5,b=0;b<o;b++){var z=v+(d<<4)+(p<<8);u=a(g),h=a(y),s=n[4095&z],s+=u*(n[z+1&4095]-s),c=n[z+16&4095],s+=h*((c+=u*(n[z+16+1&4095]-c))-s),c=n[4095&(z+=256)],c+=u*(n[z+1&4095]-c),f=n[z+16&4095],c+=h*((f+=u*(n[z+16+1&4095]-f))-c),x+=(s+=a(M)*(c-s))*m,m*=i,v<<=1,d<<=1,p<<=1,(g*=2)>=1&&(v++,g--),(y*=2)>=1&&(d++,y--),(M*=2)>=1&&(p++,M--)}return x},this.perlinDetail=function(t,n){t>0&&(o=t),n>0&&(i=n)},this.perlinSeed=function(t){var r=e();r.setSeed(t),n=new Array(4096);for(var o=0;o<4096;o++)n[o]=r.rand()};var l=void 0,u=void 0,h=[];this.simplexSeed=function(t){var n=e();n.setSeed(t),u=[];for(var r=0;r<256;r++)u[r]=Math.floor(256*n.rand());for(r=0;r<512;r++)h[r]=u[255&r]},this.simplex=function(t,n,e,o){return t=null!=t?Math.abs(t):0,n=null!=n?Math.abs(n):0,e=null!=e?Math.abs(e):0,o=null!=o?Math.abs(o):0,null==u&&r.simplexSeed((new Date).getTime()),null==l&&(l=new function(){var t=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],n=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];function r(t,n,r,e,o){return t[0]*n+t[1]*r+t[2]*e+t[3]*o}this.noise=function(e,o,i,a){var l,u,s,c,f,v,d,p,g,y,M,x,m=h,b=(Math.sqrt(5)-1)/4,z=(5-Math.sqrt(5))/20,w=(e+o+i+a)*b,S=Math.floor(e+w),k=Math.floor(o+w),I=Math.floor(i+w),P=Math.floor(a+w),A=(S+k+I+P)*z,T=e-(S-A),N=o-(k-A),O=i-(I-A),B=a-(P-A),E=(T>N?32:0)+(T>O?16:0)+(N>O?8:0)+(T>B?4:0)+(N>B?2:0)+(O>B?1:0),j=T-(l=n[E][0]>=3?1:0)+z,q=N-(u=n[E][1]>=3?1:0)+z,C=O-(s=n[E][2]>=3?1:0)+z,D=B-(c=n[E][3]>=3?1:0)+z,L=T-(f=n[E][0]>=2?1:0)+2*z,F=N-(v=n[E][1]>=2?1:0)+2*z,W=O-(d=n[E][2]>=2?1:0)+2*z,K=B-(p=n[E][3]>=2?1:0)+2*z,Q=T-(g=n[E][0]>=1?1:0)+3*z,X=N-(y=n[E][1]>=1?1:0)+3*z,H=O-(M=n[E][2]>=1?1:0)+3*z,R=B-(x=n[E][3]>=1?1:0)+3*z,J=T-1+4*z,Z=N-1+4*z,G=O-1+4*z,U=B-1+4*z,V=255&S,Y=255&k,$=255&I,_=255&P,tt=m[V+m[Y+m[$+m[_]]]]%32,nt=m[V+l+m[Y+u+m[$+s+m[_+c]]]]%32,rt=m[V+f+m[Y+v+m[$+d+m[_+p]]]]%32,et=m[V+g+m[Y+y+m[$+M+m[_+x]]]]%32,ot=m[V+1+m[Y+1+m[$+1+m[_+1]]]]%32,it=.6-T*T-N*N-O*O-B*B,at=.6-j*j-q*q-C*C-D*D,lt=.6-L*L-F*F-W*W-K*K,ut=.6-Q*Q-X*X-H*H-R*R,ht=.6-J*J-Z*Z-G*G-U*U;return 27*((it<0?0:(it*=it)*it*r(t[tt],T,N,O,B))+(at<0?0:(at*=at)*at*r(t[nt],j,q,C,D))+(lt<0?0:(lt*=lt)*lt*r(t[rt],L,F,W,K))+(ut<0?0:(ut*=ut)*ut*r(t[et],Q,X,H,R))+(ht<0?0:(ht*=ht)*ht*r(t[ot],J,Z,G,U)))}}),.5*l.noise(t,n,e,o)+.5};var s=void 0;this.plasmaSeed=function(t){(s=e()).setSeed(t)},this.plasma=function(t){var n=null!=(t=null!=t?t:{}).n?t.n:1,e=null!=t.detail?t.detail:7;null==s&&r.plasmaSeed((new Date).getTime());for(var o=Math.pow(2,n),i=o+1,a=[],l=1/0,u=-1/0,h=0;h<i;h++){a.push([]);for(var c=0;c<i;c++)a[h].push(0)}function f(t){for(var n=0,r=0;r<t.length;r++)t[r]&&(n+=t[r]);return n/t.length}function v(t,n){try{return a[n][t]}catch(t){return 0}}function d(t,n,r){r<l&&(l=r),r>u&&(u=r),a[n][t]=r}function p(t,n,r){d(t,n,f([v(t-r,n-r),v(t+r,n-r),v(t+r,n+r),v(t-r,n+r)])+(2*s.rand()-1)*Math.pow(r,e))}function g(t,n,r){d(t,n,f([v(t,n-r),v(t+r,n),v(t,n+r),v(t-r,n)])+(2*s.rand()-1)*Math.pow(r,e))}!function t(n,r){var e,o,i=n/2;if(!(i<1)){for(o=i;o<r;o+=n)for(e=i;e<r;e+=n)p(e,o,i);for(o=0;o<=r;o+=i)for(e=(o+i)%n;e<=r;e+=n)g(e,o,i);return t(n/2,r)}}(o,o);var y=u-l;return function(t,n){return(a[Math.floor(Math.abs(n%2-1)*o)][Math.floor(Math.abs(t%2-1)*o)]-l)/y}};var c=0;this.valueNoiseSeed=function(t){c=t},this.valueNoise=function(t,n,r){function e(t,n,r){return.5+.5*(t=>t-Math.floor(t))((t+.12)*(n+.34)*(r+.56)*(t+n-r)*Math.PI+c*Math.E)}t=null!=t?Math.abs(t):0,n=null!=n?Math.abs(n):0,r=null!=r?Math.abs(r):0;var o=Math.floor(t),i=Math.floor(n),a=Math.floor(r),l=t-o,u=n-i,h=r-a,s=l*l*(3-2*l),f=u*u*(3-2*u),v=h*h*(3-2*h),d=e(o,i,a),p=e(o+1,i,a),g=e(o,i+1,a),y=e(o+1,i+1,a),M=e(o,i,a+1),x=e(o+1,i,a+1),m=e(o,i+1,a+1);return 2*(d+(p-d)*s+(g-d)*f+(M-d)*v+(d-p-g+y)*s*f+(d-g-M+m)*f*v+(d-p-M+x)*v*s+(-d+p+g-y+M-x-m+e(o+1,i+1,a+1))*s*f*v)-1},this.fractal=function(t,n){var r=null!=(n=null!=n?n:{}).f?n.f:1.98,e=null!=n.s?n.s:.49,o=null!=n.b?n.b:.5,i=null!=n.octaves?n.octaves:2,a=[[0,.8,.6],[-.8,.36,-.48],[-.6,-.48,.64]];return function(n,l,u){n=null!=n?n:0,l=null!=l?l:0,u=null!=u?u:0;for(var h=0,s=0;s<i;s++){var c=t(n,l,u);h+=o*c,o*=e;var f=r*(a[0][0]*n+a[0][1]*l+a[0][2]*u),v=r*(a[1][0]*n+a[1][1]*l+a[1][2]*u),d=r*(a[2][0]*n+a[2][1]*l+a[2][2]*u);n=f,l=v,u=d}return h}};var f=1234,v=999962000357,d=function(t){for(var n=function(t){try{return(t instanceof Buffer?t:Buffer.from(t.toString(),"binary")).toString("base64")}catch(n){return btoa(t)}}(JSON.stringify(t)),r=0,e=0;e<n.length;e++)r+=n.charCodeAt(e)*Math.pow(128,e);return r};this.randomSeed=function(t){var n=t;null==n&&(n=(new Date).getTime());var e=0,o=0;for(;e%999979==0||e%999983==0||0==e||1==e;)e=(d(n)+o)%v,o+=1;f=e;for(var i=0;i<10;i++)r.random()},this.random=function(){return(f=f*f%v)/v},this.seed=function(t){this.randomSeed(t),this.perlinSeed(t),this.plasmaSeed(t),this.simplexSeed(t),this.valueNoiseSeed(t)},this.overwriteDefault=function(){Math.randomSeed=this.randomSeed,Math.random=this.random},this.normalized=function(n,r){return t.math.map(Math.random(),0,1,n,r)},this.weighted=function(t){var n=Math.random();return Math.random()<t(n)?n:r.weighted(t)},this.weighted3d=function(t){var n=Math.random(),e=Math.random(),o=Math.random();return Math.random()<t(n,e,o)?{x:n,y:e,z:o}:r.weighted3d(t)},this.gaussian=function(){return r.weighted(t.curves.gaussian)},this.shuffle=function(t){var n,r,e;for(e=t.length-1;e>0;e--)n=Math.floor(Math.random()*(e+1)),r=t[e],t[e]=t[n],t[n]=r;return t},this.choice=function(t){return t[Math.floor(t.length*Math.random())]},this.loopNoise=function(t){var n=t/2/Math.PI,e=2*Math.PI/t;return function(t,o,i){o=null!=o?o:0,i=null!=i?i:0;var a=e*(t=null!=t?t:0),l=Math.cos(a)*n,u=Math.sin(a)*n;return r.perlin(n+l+i,n+u+i,o)}},this.tileNoise=function(t,n){var e=t/2/Math.PI,o=n/2/Math.PI,i=2*Math.PI/t,a=2*Math.PI/n;return function(t,n,l){l=null!=l?l:0;var u=i*(t=null!=t?t:0),h=a*(n=null!=n?n:0),s=Math.cos(u)*e,c=Math.sin(u)*e,f=Math.cos(h)*o,v=Math.sin(h)*o;return r.simplex(e+s+l,e+c+l,o+f+l,o+v+l)}},this.blue=function(n){var r=null!=(n=null!=n?n:{}).dimension?n.dimension:2,e=null!=n.iteration?n.iteration:20,o=null!=n.sampler?n.sampler:function(){return 1==r?{x:Math.random(),y:0,z:0}:2==r?{x:Math.random(),y:Math.random(),z:0}:3==r?{x:Math.random(),y:Math.random(),z:Math.random()}:void 0},i=[];return function(){for(var n=[],r=0;r<e;r++)n.push(o());var a=0,l=0;for(r=0;r<n.length;r++){for(var u=1/0,h=0;h<i.length;h++){var s=t.vector.distance(i[h],n[r]);s<u&&(u=s)}u>l&&(l=u,a=r)}return i.push(n[a]),n[a]}}},this.curves=new function(){var n=this,r=Math.pow,e=Math.exp,o=Math.cos,i=Math.sin;this.gaussian=function(t){return r(Math.E,-18*r(t-.5,2))},this.gaussian2d=function(t,n){return Math.exp(-Math.pow(t-.5,2)/(.4*.2)-Math.pow(n-.5,2)/(.4*.2))},this.sigmoid=function(t,n){return 1/(1+e(-(n=null!=n?n:10)*(t-.5)))},this.inverseSigmoid=function(t,n){return n=null!=n?n:10,(-.1*Math.log(.00673795*(1/t-1))-.5)*(n/10)+.5},this.bean=function(t){return r(.25-r(t-.5,2),.5)*(2.6+2.4*r(t,1.5))*.54},this.squircle=function(t,n){return function(e){for(;e>Math.PI/2;)e-=Math.PI/2;for(;e<0;)e+=Math.PI/2;return t*r(1/(r(o(e),n)+r(i(e),n)),1/n)}},this.rationalQuadraticBezier=function(n,e,o,i,a){null==i&&(i=2);var l=r(1-a,2)+2*a*(1-a)*i+a*a;return t.vector.vector((r(1-a,2)*n.x+2*a*(1-a)*e.x*i+a*a*o.x)/l,(r(1-a,2)*n.y+2*a*(1-a)*e.y*i+a*a*o.y)/l,(r(1-a,2)*n.z+2*a*(1-a)*e.z*i+a*a*o.z)/l,n)},this.highBezier=function(r,e){return 1==r.length?r[0]:2==r.length?t.vector.lerp(r[0],r[1],e):t.vector.lerp(n.highBezier(r.slice(0,r.length-1),e),n.highBezier(r.slice(1),e),e)},this.smoothen=function(r,e){var o=null!=(e=null!=e?e:{}).weight?e.weight:1,i=null!=e.detail?e.detail:20;2==r.length&&(r=[r[0],t.geometry.midpoint(r[0],r[1]),r[1]]);for(var a=[],l=0;l<r.length-2;l++){var u,h,s;u=0==l?r[l]:t.geometry.midpoint(r[l],r[l+1]),h=r[l+1],s=l==r.length-3?r[l+2]:t.geometry.midpoint(r[l+1],r[l+2]);for(var c=i,f=0;f<c+(l==r.length-3);f+=1){var v=f/c;a.push(n.rationalQuadraticBezier(u,h,s,o,v))}}return a},this.fit=function(r,e){var o=null!=(e=null!=e?e:{}).smooth?e.smooth:.5,i=r;return 0!=e.smooth&&(i=n.smoothen(r,{weight:t.math.map(o,0,1,3,.5),detail:e.detail})),i.sort((t,n)=>t.x-n.x),function(n){for(var r=1;r<i.length;r++)if(n<i[r].x){var e=(n-i[r-1].x)/(i[r].x-i[r-1].x);return t.math.lerp(i[r-1].y,i[r].y,e)}return 0}}},this.math=new function(){this.map=function(t,n,r,e,o){return e+1*(t-n)/(r-n)*(o-e)},this.interpolate=function(t){return function(n,r,e){var o=t(e);return n*(1-o)+r*o}},this.lerp=this.interpolate(t=>t),this.matrixMultiply=function(t,n){for(var r=[],e=0;e<t.length;e++){r[e]=[];for(var o=0;o<n[0].length;o++){for(var i=0,a=0;a<t[0].length;a++)i+=t[e][a]*n[a][o];r[e][o]=i}}return r},this.solveLinearSystem=function(t){function n(t){return Math.abs(t)<1e-4}function r(t,n){return t.map(t=>t*n)}function e(t,n,e){var o=function(t,n){return t.map((t,r)=>t+n[r])}(e,r(n,-e[t]/n[t]));return 0==o.slice(0,-1).filter(t=>0!=t).length?0==o[o.length-1]?"underdetermined":"overdetermined":o}function o(t){for(var r=0,e=0;e<t.length&&n(t[e]);e++)r+=1;return r}function i(t){var n=t.slice();return n.sort((t,n)=>o(t)-o(n)),n}return function(t){function a(){for(var n=0;n<t.length;n++)if(o(t[n])<n)return!1;return!0}for(t=i(t);!a();)for(var l=0;l<t[0].length-2;l++)for(var u=1+l;u<t.length;u++)if(t[u][l]){if(t[u]=e(l,t[l],t[u]),"string"==typeof t[u])return t[u];t=i(t)}for(l=t[0].length-2;l>0;l--)for(u=0;u<l;u++)if(!n(t[u][l])){if(t[u]=e(l,t[l],t[u]),"string"==typeof t[u])return t[u];t=i(t)}for(u=0;u<t.length;u++){var h=1/t[u][u];1!=h&&(t[u]=r(t[u],h))}return t.map(t=>t[t.length-1])}(t.slice())}},this.geometry=new function(){var n=this;this.midpoint=function(){var n=1==arguments.length?arguments[0]:Array.apply(null,arguments),r=t.vector.add.apply(null,n);return t.vector.vector(...t.vector.scale(r,1/n.length),n[0])},this.bound=function(n){for(var r=1/0,e=-1/0,o=1/0,i=-1/0,a=1/0,l=-1/0,u=0;u<n.length;u++)n[u].x<r&&(r=n[u].x),n[u].x>e&&(e=n[u].x),n[u].y<o&&(o=n[u].y),n[u].y>i&&(i=n[u].y),n[u].z<a&&(a=n[u].z),n[u].z>l&&(l=n[u].z);return[t.vector.vector(r,o,a,n[0]),t.vector.vector(e,i,l,n[0])]},this.rectangleBound=function(t){var r=n.bound(t);return{x:r[0].x,y:r[0].y,width:r[1].x-r[0].x,height:r[1].y-r[0].y}},this.lineEquation=function(t,r){var[e,o]=n.slopeIntercept(t,r);return e!=1/0&&e!=-1/0?[e,-1,o]:[-1,0,t.x]},this.distanceToLine=function(t,r){var[e,o,i]=n.lineEquation(...r);return Math.abs(e*t.x+o*t.y+i)/Math.sqrt(e*e+o*o)},this.slopeIntercept=function(t,n){var r=n.x-t.x,e=n.y-t.y,o=r==1/0&&e==1/0||0==r&&0==e?1:e/r;return[o,t.y-o*t.x]},this.projectToQuad=function(r,e){var[o,i,a,l]=e;function u(r,e,o){var i,a=n.slopeIntercept(...e),l=n.slopeIntercept(...o),u=a[0]-l[0];if(Math.abs(u)<1e-5||Math.abs(a[0])==1/0&&Math.abs(l[0])==1/0){var h=n.distanceToLine(r,e),s=n.distanceToLine(r,o),c=n.distanceToLine(e[0],o);return Math.abs(h+s-c)>1e-5?-1:h/(h+s)}if(Math.abs(a[0])==1/0)i=[e[0].x,e[0].x*l[0]+l[1]];else if(Math.abs(l[0])==1/0)i=[o[0].x,o[0].x*a[0]+a[1]];else{var f=(l[1]-a[1])/u;i=[f,a[0]*f+a[1]]}var v=t.vector.subtract(e[0],i),d=t.vector.subtract(o[0],i),p=t.vector.subtract(r,i),g=t.vector.angle(v,p),y=t.vector.angle(v,d),M=t.vector.angle(p,d);return Math.abs(g)>Math.abs(y)||g/y<0||Math.abs(g+M-y)>1e-5?-1:g/y}var h=u(r,[o,l],[i,a]),s=u(r,[o,i],[l,a]);if(-1!=h&&-1!=s)return t.vector.vector(h,s,0,r)},this.intersect=function(r,e,o){null==o&&(o=["segment","segment"]);var i,a,l=function(){var t=n.slopeIntercept(...r),o=n.slopeIntercept(...e),i=t[0]-o[0];if(0==i)return!1;var a=(o[1]-t[1])/i,l=t[0]*a+t[1];return!(!isFinite(a)||!isFinite(l)||isNaN(a)||isNaN(l))&&[a,l]}()||(i=n.lineEquation(...r),a=n.lineEquation(...e),t.math.solveLinearSystem([[i[0],i[1],-i[2]],[a[0],a[1],-a[2]]]));if("overdetermined"==l)return!1;function u(t,r){return"segment"==r?n.bound(t):"ray"==r?n.bound([t[0],Okb.vector.scale(Okb.vector.subtract(t[1],t[0]),1/0)]):"line"==r?[[-1/0,-1/0],[1/0,1/0]]:void 0}function h(t,n){return n[0].x<=t.x&&t.x<=n[1].x&&n[0].y<=t.y&&t.y<=n[1].y}var s=u(r,o[0]),c=u(e,o[1]);return"underdetermined"==l?n.rectangleOverlap(n.rectangleBound(s),n.rectangleBound(c)):!(!h(l,s)||!h(l,c))&&l},this.pointInPolygon=function(t,r){for(var e=0,o=0;o<r.length;o++){var i=r[o!=r.length-1?o+1:0];0!=n.intersect([r[o],i],[t,[t.x+1,t.y+Math.PI]],["segment","ray"])&&e++}return e%2==1},this.polygonSides=function(t){for(var n=[],r=0;r<t.length;r++){var e=t[r],o=t[r!=t.length-1?r+1:0],i=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2));n.push(i)}return n},this.polygonArea=function(t){var r=n.polygonSides(t),e=r[0],o=r[1],i=r[2],a=(e+o+i)/2;return Math.sqrt(a*(a-e)*(a-o)*(a-i))},this.triangulate=function(t,r){var e=null!=(r=null!=r?r:{}).area?r.area:100,o=null!=r.convex&&r.convex,i=null==r.optimize||r.optimize;function a(t,r){var e=[[0,0],[0,0]],o=.01;e[0][0]=.99*t[0].x+t[1].x*o,e[0][1]=.99*t[0].y+t[1].y*o,e[1][0]=t[0].x*o+.99*t[1].x,e[1][1]=t[0].y*o+.99*t[1].y;for(var i=0;i<r.length;i++){var a=r[i],l=r[i!=r.length-1?i+1:0];if(0!=n.intersect(e,[a,l]))return!1}var u=n.midpoint(t);return 0!=n.pointInPolygon(u,r)}function l(t){return n.polygonArea(t)/n.polygonSides(t).reduce(function(t,n){return t+n},0)}function u(t,r){if(0==t.length)return[];if(n.polygonArea(t)<r)return[t];var e=n.polygonSides(t).reduce((t,n,r,e)=>n>e[t]?r:t,0),o=(e+1)%t.length,i=(e+2)%t.length;try{var a=n.midpoint([t[e],t[o]])}catch(n){return console.log("triangulation err:",t,n),[]}return u([t[e],a,t[i]],r).concat(u([t[i],t[o],a],r))}if(t.length<=3)return u(t,e);var h=function(t){for(var n=[],r=0;r<t.length;r++){var e=t[r],u=t[0!=r?r-1:t.length-1],h=t[r!=t.length-1?r+1:0],s=t.slice();if(s.splice(r,1),o||a([u,h],t)){var c=[[u,e,h],s];if(!i)return c;n.push(c)}}var f=[t,[]],v=0;for(r=0;r<n.length;r++){var d=l(n[r][0]);d>=v&&(f=n[r],v=d)}return f}(t);return u(h[0],e).concat(n.triangulate(h[1],r))},this.rectangleOverlap=function(t,n){return t.x<=n.x+n.width&&t.x+t.width>=n.x&&t.y<=n.y+n.height&&t.y+t.height>=n.y},this.polygonOverlap=function(t,r){for(var e=0;e<t.length;e++)for(var o=[t[e],t[(e+1)%t.length]],i=0;i<r.length;i++){var a=[r[i],r[(i+1)%r.length]];if(n.intersect(o,a))return!0}return!!n.pointInPolygon(t[0],r)||!!n.pointInPolygon(r[0],t)},this.tube=function(n,r){for(var e=n,o=(r=null!=r?r:t=>10,[]),i=[],a=1;a<e.length-1;a++){var l=r(a/e.length),u=Math.atan2(e[a].y-e[a-1].y,e[a].x-e[a-1].x),h=Math.atan2(e[a].y-e[a+1].y,e[a].x-e[a+1].x),s=(u+h)/2;s<h&&(s+=Math.PI);var c=l*Math.cos(s),f=l*Math.sin(s);o.push(t.vector.vector(e[a].x+c,e[a].y+f,e[a].z,e[a])),i.push(t.vector.vector(e[a].x-c,e[a].y-f,e[a].z,e[a]))}var v=e.length-1,d=Math.atan2(e[1].y-e[0].y,e[1].x-e[0].x)-Math.PI/2,p=(u=Math.atan2(e[v].y-e[v-1].y,e[v].x-e[v-1].x)-Math.PI/2,r(0)),g=r(1),y=p*Math.cos(d),M=p*Math.sin(d),x=g*Math.cos(u),m=g*Math.sin(u);return o.unshift(t.vector.vector(e[0].x+y,e[0].y+M,e[0].z,e[0])),i.unshift(t.vector.vector(e[0].x-y,e[0].y-M,e[0].z,e[0])),o.push(t.vector.vector(e[v].x+x,e[v].y+m,e[v].z,e[v])),i.push(t.vector.vector(e[v].x-x,e[v].y-m,e[v].z,e[v])),[o,i]},this.subdivide=function(n,r){for(var e=(n.length-1)*r,o=[],i=0;i<e;i+=1){var a=n[Math.floor(i/r)],l=n[Math.ceil(i/r)],u=i%r/r,h=t.vector.lerp(a,l,u);o.push(h)}return n.length>0&&o.push(n[n.length-1]),o},this.redivide=function(n,r){if(n.length<=1)return n;for(var e=t.vector.distance.apply(null,n)/r,o=0,i=t.vector.distance(n[0],n[1]),a=[],l=0,u=0;u<r+1;u++){for(;l>i+.01&&o<n.length-2;)l-=Math.max(i,.01),o+=1,i=t.vector.distance(n[o],n[o+1]),1;var h=l/i,s=t.vector.lerp(n[o],n[o+1],h);a.push(s),l+=e}return a},this.convexHull=function(t){t.length;var n=t.slice(),r=n.splice(function(t){for(var n=0,r=1/0,e=0;e<t.length;e++)t[e].y<r&&(r=t[e].y,n=e);return n}(t),1)[0],e=t=>Math.atan2(t.y-r.y,t.x-r.x);n.sort((t,n)=>e(t)-e(n)),n.unshift(r);var o,i,a,l=[];l.push(n[0]),l.push(n[1]);for(var u=2;u<n.length;u++){for(;l.length>=2&&(o=l[l.length-2],i=l[l.length-1],a=n[u],(i.x-o.x)*(a.y-o.y)-(i.y-o.y)*(a.x-o.x)<=0);)l.pop();l.push(n[u])}return l}},this.graphics=new function(){var n=this;this.BACKEND="canvas",this.CONTEXT=void 0,this.backend=function(t){n.BACKEND=t},this.context=function(t){n.CONTEXT=t},this.polygon=function(r){var e=null!=(r=null!=r?r:{}).context?r.context:n.CONTEXT,o=null!=r.backend?r.backend:n.BACKEND,i="fill"in r?r.fill:[255,255,255],a="stroke"in r?r.stroke:[0,0,0],l=null!=r.strokeWidth?r.strokeWidth:1,u=null!=r.offset?r.offset:{x:0,y:0},h=null==r.close||r.close;return function(n){if("canvas"==o){e.beginPath(),n.length>0&&e.moveTo(n[0].x+u.x,n[0].y+u.y);for(var r=1;r<n.length;r++)e.lineTo(n[r].x+u.x,n[r].y+u.y);null!=i&&(e.fillStyle=t.color.css(i),e.fill()),null!=a&&(h&&e.lineTo(n[0].x+u.x,n[0].y+u.y),e.strokeStyle=t.color.css(a),e.lineWidth=l,e.stroke())}else{if("svg"==o){var s='<path d ="M';for(r=0;r<n.length+!!h;r++)1==r&&(s+="L"),s+=n[r%n.length].x+u.x+" "+(n[r%n.length].y+u.y)+" ";return s+='" stroke="'+t.color.css(a)+(l>0?'" stroke-width="'+l:"")+'" fill="'+t.color.css(i),s+='"/>'}if("p5"==o){null!=i?e.fill.apply(null,i):e.noFill(),null!=a?(e.stroke.apply(null,a),e.strokeWeight(l)):e.noStroke(),e.beginShape();for(r=0;r<n.length+!!h;r++){var c=u.z,f=r%n.length;null!=n[f].z&&(c=c||0,e.vertex(n[f].x+u.x,n[f].y+u.y,n[f].z+c)),e.vertex(n[f].x+u.x,n[f].y+u.y)}e.endShape()}}}},this.brushstroke=function(r){var e=null!=(r=null!=r?r:{}).color?r.color:[0,0,0],o=Math.random()*Math.PI,i=null!=r.widthFunction?r.widthFunction:n=>10*Math.sin(n*Math.PI)*t.math.map(t.random.perlin(10*n,o),0,1,.7,1);return function(o){var a=null!=r.resample?r.resample:Math.ceil(t.vector.distance.apply(null,o)/10),l=Object.assign({},r,{fill:e,stroke:r.stroke}),u=o;a>0&&(u=t.geometry.redivide(u,a));var[h,s]=t.geometry.tube(u,i);return n.polygon(l)(h.concat(s.slice().reverse()))}},this.projectTexture=function(r){for(var e=null!=(r=null!=r?r:{}).context?r.context:n.CONTEXT,o=null!=r.backend?r.backend:n.BACKEND,i=null!=r.texture?r.texture:[[[0]]],a=null!=r.vertices?r.vertices:[[0,0],[64,0],[64,64],[0,64]],l=null!=r.pixelSize?r.pixelSize:1,[u,h]=t.geometry.bound(a),s="",c=u.x;c<h.x;c+=l)for(var f=u.y;f<h.y;f+=l){var v=t.geometry.projectToQuad([c,f],a);if(null!=v&&0<=v.x&&v.x<=1&&0<=v.y&&v.y<=1){var d;try{d=i[Math.floor(v.y*i.length)][Math.floor(v.x*i[0].length)]}catch(t){continue}null!=d&&("canvas"==o?(e.fillStyle=t.color.css(d),e.fillRect(c,f,l,l)):"p5"==o?(e.fill.apply(null,d),e.noStroke(),e.rect(c,f,l,l)):"svg"==o&&(s+='<path d="M'+c+" "+f+" h"+l+" v"+l+" h -"+l+' Z" fill="'+t.color.css(d)+'" stroke="none"/>'))}}if("svg"==o)return s}},this.color=new function(){var n=this;this.hsv=function(t,n,r){var e=r*n,o=e*(1-Math.abs(t/60%2-1)),i=r-e,[a,l,u]=[[e,o,0],[o,e,0],[0,e,o],[0,o,e],[o,0,e],[e,0,o]][Math.floor(t/60)];return[255*(a+i),255*(l+i),255*(u+i)]},this.css=function(){var t=Math.floor;return 1==arguments.length?null==arguments[0]?"none":"number"==typeof arguments[0]?"rgb("+t(arguments[0])+","+t(arguments[0])+","+t(arguments[0])+")":"string"==typeof arguments[0]?arguments[0]:n.css.apply(null,arguments[0]):2==arguments.length?"rgba("+t(arguments[0])+","+t(arguments[0])+","+t(arguments[0])+","+arguments[1]+")":3==arguments.length?"rgb("+t(arguments[0])+","+t(arguments[1])+","+t(arguments[2])+")":4==arguments.length?"rgba("+t(arguments[0])+","+t(arguments[1])+","+t(arguments[2])+","+arguments[3]+")":void 0},this.lerpHue=function(n,r,e){var o=[[Math.abs(r-n),t.math.map(e,0,1,n,r)],[Math.abs(r+360-n),t.math.map(e,0,1,n,r+360)],[Math.abs(r-360-n),t.math.map(e,0,1,n,r-360)]];return o.sort((t,n)=>t[0]-n[0]),(o[0][1]+720)%360}},this.texture=new function(){this.wood=function(n){for(var r=null!=(n=null!=n?n:{}).width?n.width:512,e=null!=n.height?n.height:512,o=null!=n.scale?n.scale:1,i=null!=n.grain?n.grain:1,a=null!=n.tile&&n.tile,l=null!=n.colorA?n.colorA:[100,50,10],u=null!=n.colorB?n.colorB:[210,162,104],h=[],s=0;s<e;s++){h.push([]);for(var c=0;c<r;c++)h[s].push([0,0,0])}var f=1/(o*r/512),v=e/5*o;for(s=0;s<e+v;s++)for(c=0;c<r;c++){var d=.001*f,p=.004*f,g=.1*f,y=.5*f;if(a)M=Math.floor(1e3*t.random.tileNoise(e*d,r*p)(s*d,c*p)*Math.pow(f,-.8)),x=Math.floor(90*t.random.tileNoise(e*g,r*y)(s*g,c*y)*i);else var M=Math.floor(1e3*t.random.perlin(s*d,c*p)*Math.pow(f,-.8)),x=Math.floor(90*t.random.perlin(s*g,c*y)*i);var m,b=[l[0]-x,l[1]-x,l[2]-x],z=[u[0]-x,u[1]-x,u[2]-x];m=M%40<30?t.vector.lerp(b,z,M%40/30):t.vector.lerp(b,z,(M%40-30)/10);var w=Math.round(s+t.random.perlin(.05*c*f)*v-v);0<=w&&w<e&&(h[w][c]=m)}return h},this.ricePaper=function(n){for(var r=null!=(n=null!=n?n:{}).width?n.width:512,e=null!=n.height?n.height:512,o=null!=n.color?n.color:[250,232,189],i=null!=n.grain?n.grain:20,a=null!=n.sprinkle?n.sprinkle:1,l=[],u=0;u<e;u++){l.push([]);for(var h=0;h<r;h++)l[u].push([0,0,0])}for(u=0;u<e;u++)for(h=0;h<r;h++){var s=255-t.random.perlin(.1*u,.1*h)*i*.5,c=(s-=Math.random()*i)*o[0]/255,f=s*o[1]/255,v=s*o[2]/255;(t.random.perlin(.04*u,.04*h,2)*Math.random()*a>.7||Math.random()<.005*a)&&(c=.7*s,f=.5*s,v=.2*s),l[u][h]=[c,f,v]}return l};this.knitPattern=function(n){for(var r=null!=(n=null!=n?n:{}).width?n.width:128,e=null!=n.height?n.height:128,o=null!=n.mono&&n.mono,i=null!=n.hue?n.hue:360*Math.random(),a=null!=n.scale?n.scale:10,l=[],u=0;u<e;u++){l.push([]);for(var h=0;h<r;h++)l[u].push(o?0:[0,0,0])}var s=function(n,r){return function(e,o,i){null==i&&(i=0);var a=n/2/Math.PI,l=e/n*(2*Math.PI),u=o/r*(2*Math.PI),h=a*Math.sin(l)*Math.cos(u),s=a*Math.sin(l)*Math.sin(u),c=a*Math.cos(l),f=a;return t.random.perlin(f+h,f+s,f+c+i)}}(a,a);for(u=0;u<e;u++)for(h=0;h<r;h++){var c=a*u/e,f=a*h/r;if(o){v=Math.floor(s(f,c));l[u][h]=[v,v,v]}else{var v=s(f,c),d=s(f,c,Math.E),p=s(f,c,Math.PI);l[u][h]=t.color.hsv(Math.floor((360*v+i)%360),d,p)}}return l}},this.explode=function(n){if(null==n&&(n=1),"object"==typeof window){var r=[];if(1==n)for(var e=Object.keys(t),o=0;o<e.length;o++)e[o]in window?console.log("identifier clash: ",e[o],", skipping..."):(window[e[o]]=t[e[o]],r.push(e[o]));else if(n>=2)for(e=Object.keys(t),o=0;o<e.length;o++)for(var i=Object.keys(t[e[o]]),a=0;a<i.length;a++)i[a]in window?console.log("identifier clash: ",i[a],", skipping..."):(window[i[a]]=t[e[o]][i[a]],r.push(i[a]));return console.log("exploded into global scope: ",r),r}console.log("`explode()` only works in browser mode!")}};"object"==typeof module&&(module.exports=Okb);
